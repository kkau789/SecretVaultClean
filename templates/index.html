<!DOCTYPE html>
<html>
<head>
  <title>Secret Vault</title>
</head>
<body>
  <h1>ğŸ” Secret Vault</h1>

  <button onclick="register()">Register Fingerprint</button>
  <button onclick="login()">Login with Fingerprint</button>

  <script>
    function bufferDecode(value) {
      return Uint8Array.from(atob(value), c => c.charCodeAt(0));
    }

    function register() {
      fetch("/register/begin")
        .then(res => res.json())
        .then(options => {
          options.challenge = bufferDecode(options.challenge);
          options.user.id = bufferDecode(options.user.id);

          return navigator.credentials.create({ publicKey: options });
        })
        .then(credential => fetch("/register/complete", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(credential)
        }))
        .then(() => alert("Registration successful!"))
        .catch(err => console.error(err));
    }

    function login() {
      fetch("/login/begin")
        .then(res => res.json())
        .then(options => {
          options.challenge = bufferDecode(options.challenge);

          return navigator.credentials.get({ publicKey: options });
        })
        .then(assertion => fetch("/login/complete", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(assertion)
        }))
        .then(() => alert("Login successful!"))
        .catch(err => console.error(err));
    }
  </script>
</body>
</html>
